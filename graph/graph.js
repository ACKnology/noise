//jscs:disable
var raw = [null,-117.72161879948817,-113.17549473102395,-127.34529276446152,-118.98628748363447,-114.07088284670249,-130.99126390328098,-99.48083500528901,-104.60565581049508,-123.21775183245593,-98.64973146051861,-126.9616251007127,-108.92247521028891,-107.5048892618468,-125.19501359545002,-122.92341918449762,-106.10312966561068,-121.94198786262369,-110.39124704131517,-104.90306457752858,-110.17294104729947,-115.58386965929367,-106.92512587275431,-121.04030093115087,-122.78974050446186,-118.4969913672059,-156.13859825214962,-112.17586259767256,-121.7056913165747,-156.2431618473902,-107.59744164774537,-115.99776847218439,-121.40551658660257,-124.20237984088287,-110.65947470608214,-126.62683481270957,-109.77594974908578,-111.15593157828529,-88.04762371030725,-110.35675568694258,-127.42146762544785,-111.66076249577432,-140.73829073959286,-95.75199348710308,-102.75995950603925,-121.47417902752355,-131.63053766101615,-106.91127843368028,-109.92957886203499,-118.57523013573913,-124.34331074599159,-130.5701905223073,-115.24062183679432,-114.8841020736786,-132.73308514680392,-110.19844611204852,-129.24421351318733,-116.99470387444111,-129.1570347569817,-114.62498488266668,-121.55936518363251,-111.63011151862949,-110.02338028752666,-133.24246372705093,-123.81926508165719,-103.04610670151432,-118.03441136989824,-116.99061608459871,-156.23565087937553,-124.7528288688022,-104.23016644441654,-129.65307590314328,-108.07360475108482,-136.20517886851485,-117.06077442368004,-113.5966044423734,-111.93104630436643,-140.36851506226304,-129.06355667943643,-116.67038087946453,-106.3479350515951,-117.90832638635281,-125.66316397379687,-121.47579576153461,-65.99720157706278,50.77994452605864,48.38330598701915,51.01892051686386,51.020978429996916,54.26325232378999,55.44976040368529,56.159129720048426,55.67771638601115,55.02111036375481,54.253026911811475,54.3239812563316,53.56208855033878,52.494533041499054,51.83110216969328,51.673785146277005,51.43419764031631,51.15940509500649,51.10036461132184,51.05433675065662,51.10267614840068,51.2503801165364,51.30893032593987,48.86069551990636,18.838179722026023,-5.86266436075639,43.83293139229872,2.860177442169472,6.4998713137760475,6.385476449067951,5.7426456287372,6.622451588391054,3.5386447660220623,50.021479358649785,49.52338245132673,22.905654140172484,47.40833859382508,1.6263094206785613,2.534703723120297,-14.710515131743787,8.274342020498914,49.21494176713887,48.07997766623515,7.659397501418283,5.972325303975148,44.87845037861456,11.236145841176771,46.179087426099784,13.398920509444356,49.126258447631,46.83565257458942,16.995114566222746,48.377136028297905,46.23042092063553,10.312290043073709,-6.541082426462699,-2.9972763422272126,43.78636470046153,51.005576985608315,51.90414667285669,51.0767732288756,29.354301616645838,10.43657776057662,43.65228337744344,23.210652555800728,45.941356975205736,50.172953411299616,31.609888376207444,46.4925331828253,49.82572505746365,51.53440773621459,50.943527454367086,29.649144750158975,4.569381707847041,42.14768236644044,23.325923734525283,4.003556849310675,1.78645025201572,1.025272478551908,10.097413970914191,36.08682782239504,49.40690199033281,50.00995704736195,48.728095037552805,48.50306245586075,49.14176314466203,49.22042911000993,49.20614022988435,49.30260886790499,49.38361537818575,49.52271476260614,49.340811697136,49.224753701993016,49.323093545687016,49.390903369536474,49.12052055864565,48.87881635580611,48.91243930347262,48.06801465871214,43.635415565755366,38.68719816490318,33.43459351493377,28.396995590960394,1.7072597787880146,-44.68036034245161,-40.05268821356477,-36.2941989035363,-44.350118042616984,-50.61957103540847,-60.1755193254881,-55.984426051000504,-58.95618480330991,-62.01648633590228,-95.20888489237416,-136.6937598880611,-127.69728647467714,-99.3334543013093,-109.24774666780851,-108.16104033256222,-122.07089469761706,-128.4853622753341,-125.06314717917763,-118.00265683168575,-158.54702964693325,-135.90995660347284,-165.2738330001962,-170.99666636626338,-131.60780022073362,-127.9589735077657,-133.72141992654366,-149.5022053652939,-130.14134264553235,-142.98152663500082,-134.013795098553,-125.99377968140388,-148.40468694332964,-138.17648502254974,-115.57367545102568,-145.0594027206738,-149.67337551437592,-125.04400343802803,-116.61204868507133,-133.18153051455107,-125.38585482020564,-175.41766798635422];
//jscs:enable
var rawGraph = document.createElement('canvas');
var rawHeight = 400;
var rawWidth = 600;
rawGraph.setAttribute('height', rawHeight + 'px');
rawGraph.setAttribute('width', rawWidth + 'px');
var rawCtx = rawGraph.getContext('2d');

raw = raw
.filter(function(v) {
  return v !== null && v !== -Infinity;
});

var rawMin = _.min(raw);

raw = raw.map(function(v) {
  // 0 out min
  return v -= rawMin;
});

var rawMax = _.max(raw);

raw = raw
.map(function(v) {
  // Normalize to 0 - 1
  return v / rawMax;
});

raw.forEach(function(v, i) {
  rawCtx.fillRect(i * rawWidth / raw.length, v * rawHeight * 0.95 , 5 , 5);
});

document.body.appendChild(rawGraph);

var movingAverageGraph = document.createElement('canvas');
movingAverageGraph.setAttribute('height', rawHeight + 'px');
movingAverageGraph.setAttribute('width', rawWidth + 'px');
var movingAverageCtx = movingAverageGraph.getContext('2d');
var movingAverageWindow = 20;

movingAverage = raw
.map(function(v, i, arr) {
  for (var j = 0; j < movingAverageWindow && arr[i + j] !== undefined; ++j) {
    v += arr[i + j];
  }
  return v *= 1 / movingAverageWindow;
});

var movingAverageMin = _.min(movingAverage);

movingAverage = movingAverage.map(function(v) {
  return v - movingAverageMin;
});

var movingAverageMax = _.max(movingAverage);

movingAverage = movingAverage.map(function(v) {
  return v / movingAverageMax;
});

movingAverage.forEach(function(v, i) {
  movingAverageCtx.fillRect(i * rawWidth / movingAverage.length, v * rawHeight * 0.95, 5, 5);
});

movingAverageGraph.style.opacity = '0.5';
document.body.appendChild(movingAverageGraph);

var diffGraph = document.createElement('canvas');
diffGraph.setAttribute('height', rawHeight + 'px');
diffGraph.setAttribute('width', rawWidth + 'px');
var diffGraphCtx = diffGraph.getContext('2d');
var diffRange = 20;

diffPoints = movingAverage
.map(function(v, i, arr) {
  return v - _.sum(arr.slice(i, i + diffRange)) / diffRange;
});

var minDiff = _.min(diffPoints);

diffPoints = diffPoints
.map(function(v) {
  return v -= minDiff;
});

var maxDiff = _.max(diffPoints);

diffPoints = diffPoints
.map(function(v) {
  return v / maxDiff;
});

var maxChange = _.max(diffPoints);
var minChange = _.min(diffPoints);
diffPoints
.forEach(function(v, i) {
  diffGraphCtx.fillStyle = 'black';

  if (v == minChange) {
    diffGraphCtx.fillStyle = 'red';
  }

  if (v == maxChange) {
    diffGraphCtx.fillStyle = 'orange';
  }

  diffGraphCtx.fillRect(i * rawWidth / diffPoints.length, v * rawHeight * 0.95, 5, 5);
});

document.body.appendChild(diffGraph);

