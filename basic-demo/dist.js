(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.noise = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var stringToBinary = require('string-to-binary');
var binaryToString = require('binary-to-string');

var Audio = window.AudioContext || window.webkitAudioContext;
var context = new Audio();
var SAMPLE_RATE = context.sampleRate;
var bufferFrameSize = 2048;
var low = 2125;
var high = 2295;
var lastTime = 0;

function getNumberOfPaddingBits(bitsPerSecond) {
  return Math.ceil(bitsPerSecond / 2) + 2;
}

function decode(out, baud) {
  var BitThreshold = 65 - 0.18 * baud;

  var unmap = out.map(function (v) {
    return v.m > BitThreshold ? 1 : 0;
  });
  var unpadded = unpadSignal(unmap, baud);

  document.querySelector('#output').innerHTML = binaryToString(unpadded.join(''));
}

function unpadSignal(bits, bitsPerSecond) {
  bits = bits.slice(getNumberOfPaddingBits(bitsPerSecond));
  return bits.slice(0, -getNumberOfPaddingBits(bitsPerSecond));
}

function padSignal(bits, bitsPerSecond) {
  var padBits = '';

  for (var i = 0; i < getNumberOfPaddingBits(bitsPerSecond); ++i) {
    padBits += i < getNumberOfPaddingBits(bitsPerSecond) - 2 ? '1' : 0;
  }

  return padBits + bits + padBits;
}

function hamming(n, N) {
  return 0.54 - 0.47 * Math.cos(2 * Math.PI * n / N);
}

function goertzel(k, binsPerBit, raw, out) {
  var realW = 2 * Math.cos(2 * Math.PI * k / binsPerBit);
  var imagW = Math.sin(2 * Math.PI * k / binsPerBit);

  while (raw.length >= binsPerBit) {
    var chunk = raw.slice(0, binsPerBit);
    raw = raw.slice(binsPerBit);
    var d1 = 0;
    var d2 = 0;

    for (var i = 0; i < binsPerBit; ++i) {
      var x = chunk[i];
      x *= hamming(x, binsPerBit);
      var y = x + realW * d1 - d2;
      d2 = d1;
      d1 = y;
    }

    var r = 0.5 * realW * d1 - d2;
    var im = imagW * d1;

    out.push({
      real: r,
      imag: im * d1,
      m: 20 * Math.log(Math.sqrt(Math.pow(r, 2) + Math.pow(im, 2)))
    });
  }

  return raw;
}

function run(b, message) {
  var baud = b || 45.45;
  var binsPerBit = Math.ceil(SAMPLE_RATE / baud);

  var out = [];
  var data = padSignal(stringToBinary(message || document.querySelector('#input').value), baud);
  var remainder = [];
  var k = 0.5 + binsPerBit * high / SAMPLE_RATE;
  var length = 1 / baud;

  var osc = context.createOscillator();
  var processor = context.createScriptProcessor(bufferFrameSize, 1, 1);

  osc.connect(processor);
  osc.connect(context.destination);
  processor.connect(context.destination);

  processor.onaudioprocess = function (e) {
    var processData = e.inputBuffer.getChannelData(0);
    remainder = remainder.concat(Array.prototype.slice.call(processData, 0));
    remainder = goertzel(k, binsPerBit, remainder, out);
  };

  data.split('').forEach(function (v, i) {
    osc.frequency.setValueAtTime(v == '1' ? high : low, i * length + context.currentTime);
  });

  osc.start(context.currentTime);
  osc.frequency.value = 0;

  osc.stop(data.length * length + context.currentTime);
  lastTime = data.length * length;

  osc.onended = function () {
    osc.disconnect(processor);
    osc.disconnect(context.destination);
    processor.disconnect(context.destination);
    decode(out, baud);
  };
}

module.exports = {
  run: run
};

},{"binary-to-string":2,"string-to-binary":3}],2:[function(require,module,exports){
module.exports = function(binary) {
  var out = '';
  while(binary.length >= 8) {
   var byte = binary.slice(0, 8);
   var binary = binary.slice(8);
   out += String.fromCharCode(parseInt(byte, 2));
  }

  return out;
}

},{}],3:[function(require,module,exports){
module.exports = function(str) {
  var pad = "00000000";

  return str.split('').map(function(str) {
    var binary = str.charCodeAt(0).toString(2);

    return pad.slice(binary.length)+binary;
  }).join('');
}

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvc2FtL0Rlc2t0b3AvcmVwb3MvYWZzay9iYXNpYy1kZW1vL2luZGV4LmpzIiwibm9kZV9tb2R1bGVzL2JpbmFyeS10by1zdHJpbmcvaW5kZXguanMiLCJub2RlX21vZHVsZXMvc3RyaW5nLXRvLWJpbmFyeS9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDbkQsSUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7O0FBRW5ELElBQU0sS0FBSyxHQUFJLE1BQU0sQ0FBQyxZQUFZLElBQUksTUFBTSxDQUFDLGtCQUFrQixBQUFDLENBQUM7QUFDakUsSUFBTSxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztBQUM1QixJQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBQ3ZDLElBQU0sZUFBZSxHQUFHLElBQUksQ0FBQztBQUM3QixJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUM7QUFDakIsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO0FBQ2xCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQzs7QUFFakIsU0FBUyxzQkFBc0IsQ0FBQyxhQUFhLEVBQUU7QUFDN0MsU0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7Q0FDekM7O0FBRUQsU0FBUyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRTtBQUN6QixNQUFNLFlBQVksR0FBRyxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQzs7QUFFdEMsTUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFTLENBQUMsRUFBRTtBQUFFLFdBQU8sQ0FBQyxDQUFDLENB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QVUsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDMUMsVUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztHQUNuQixDQUFDO0NBQ0g7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRztBQUNmLEtBQUcsRUFBRSxHQUFHO0NBQ1QsQ0FBQzs7O0FDeEhGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiY29uc3Qgc3RyaW5nVG9CaW5hcnkgPSByZXF1aXJlKCdzdHJpbmctdG8tYmluYXJ5Jyk7XG5jb25zdCBiaW5hcnlUb1N0cmluZyA9IHJlcXVpcmUoJ2JpbmFyeS10by1zdHJpbmcnKTtcblxuY29uc3QgQXVkaW8gPSAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KTtcbmNvbnN0IGNvbnRleHQgPSBuZXcgQXVkaW8oKTtcbmNvbnN0IFNBTVBMRV9SQVRFID0gY29udGV4dC5zYW1wbGVSYXRlO1xuY29uc3QgYnVmZmVyRnJhbWVTaXplID0gMjA0ODtcbmNvbnN0IGxvdyA9IDIxMjU7XG5jb25zdCBoaWdoID0gMjI5NTtcbmxldCBsYXN0VGltZSA9IDA7XG5cbmZ1bmN0aW9uIGdldE51bWJlck9mUGFkZGluZ0JpdHMoYml0c1BlclNlY29uZCkge1xuICByZXR1cm4gTWF0aC5jZWlsKGJpdHNQZXJTZWNvbmQgLyAyKSArIDI7XG59XG5cbmZ1bmN0aW9uIGRlY29kZShvdXQsIGJhdWQpIHtcbiAgY29uc3QgQml0VGhyZXNob2xkID0gNjUgLSAwLjE4ICogYmF1ZDtcblxuICBsZXQgdW5tYXAgPSBvdXQubWFwKGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHYubSA+IEJpdFRocmVzaG9sZCA/IDEgOiAwOyB9KTtcbiAgbGV0IHVucGFkZGVkID0gdW5wYWRTaWduYWwodW5tYXAsIGJhdWQpO1xuXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNvdXRwdXQnKS5pbm5lckhUTUwgPSBiaW5hcnlUb1N0cmluZyh1bnBhZGRlZC5qb2luKCcnKSk7XG59XG5cbmZ1bmN0aW9uIHVucGFkU2lnbmFsKGJpdHMsIGJpdHNQZXJTZWNvbmQpIHtcbiAgYml0cyA9IGJpdHMuc2xpY2UoZ2V0TnVtYmVyT2ZQYWRkaW5nQml0cyhiaXRzUGVyU2Vjb25kKSk7XG4gIHJldHVybiBiaXRzLnNsaWNlKDAsIC1nZXROdW1iZXJPZlBhZGRpbmdCaXRzKGJpdHNQZXJTZWNvbmQpKTtcbn1cblxuZnVuY3Rpb24gcGFkU2lnbmFsKGJpdHMsIGJpdHNQZXJTZWNvbmQpIHtcbiAgbGV0IHBhZEJpdHMgPSAnJztcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGdldE51bWJlck9mUGFkZGluZ0JpdHMoYml0c1BlclNlY29uZCk7ICsraSkge1xuICAgIHBhZEJpdHMgKz0gaSA8IGdldE51bWJlck9mUGFkZGluZ0JpdHMoYml0c1BlclNlY29uZCkgLSAyID8gJzEnIDogMDtcbiAgfVxuXG4gIHJldHVybiBwYWRCaXRzICsgYml0cyArIHBhZEJpdHM7XG59XG5cbmZ1bmN0aW9uIGhhbW1pbmcobiwgTikge1xuICByZXR1cm4gMC41NCAtIDAuNDcgKiBNYXRoLmNvcygyICogTWF0aC5QSSAqIG4gLyBOKTtcbn1cblxuZnVuY3Rpb24gZ29lcnR6ZWwoaywgYmluc1BlckJpdCwgcmF3LCBvdXQpIHtcbiAgY29uc3QgcmVhbFcgPSAyICogTWF0aC5jb3MoMiAqIE1hdGguUEkgKiBrIC8gYmluc1BlckJpdCk7XG4gIGNvbnN0IGltYWdXID0gTWF0aC5zaW4oMiAqIE1hdGguUEkgKiBrIC8gYmluc1BlckJpdCk7XG5cbiAgd2hpbGUgKHJhdy5sZW5ndGggPj0gYmluc1BlckJpdCkge1xuICAgIGxldCBjaHVuayA9IHJhdy5zbGljZSgwLCBiaW5zUGVyQml0KTtcbiAgICByYXcgPSByYXcuc2xpY2UoYmluc1BlckJpdCk7XG4gICAgbGV0IGQxID0gMC4wO1xuICAgIGxldCBkMiA9IDAuMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmluc1BlckJpdDsgKytpKSB7XG4gICAgICBsZXQgeCA9IGNodW5rW2ldO1xuICAgICAgeCAqPSBoYW1taW5nKHgsIGJpbnNQZXJCaXQpO1xuICAgICAgbGV0IHkgPSB4ICsgcmVhbFcgKiBkMSAtIGQyO1xuICAgICAgZDIgPSBkMTtcbiAgICAgIGQxID0geTtcbiAgICB9XG5cbiAgICBjb25zdCByID0gMC41ICogcmVhbFcgKiBkMSAtIGQyO1xuICAgIGNvbnN0IGltID0gaW1hZ1cgKiBkMTtcblxuICAgIG91dC5wdXNoKHtcbiAgICAgIHJlYWw6IHIsXG4gICAgICBpbWFnOiBpbSAqIGQxLFxuICAgICAgbTogMjAgKiBNYXRoLmxvZyhNYXRoLnNxcnQoTWF0aC5wb3cociwgMikgKyBNYXRoLnBvdyhpbSwgMikpKVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHJhdztcbn1cblxuZnVuY3Rpb24gcnVuKGIsIG1lc3NhZ2UpIHtcbiAgY29uc3QgYmF1ZCA9IGIgfHwgNDUuNDU7XG4gIGNvbnN0IGJpbnNQZXJCaXQgPSBNYXRoLmNlaWwoU0FNUExFX1JBVEUgLyBiYXVkKTtcblxuICBsZXQgb3V0ID0gW107XG4gIGxldCBkYXRhID0gcGFkU2lnbmFsKFxuICAgIHN0cmluZ1RvQmluYXJ5KG1lc3NhZ2UgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2lucHV0JykudmFsdWUpLFxuICAgIGJhdWRcbiAgKTtcbiAgbGV0IHJlbWFpbmRlciA9IFtdO1xuICBsZXQgayA9IDAuNSArIChiaW5zUGVyQml0ICogKGhpZ2gpIC8gU0FNUExFX1JBVEUpO1xuICBsZXQgbGVuZ3RoID0gMSAvIGJhdWQ7XG5cbiAgY29uc3Qgb3NjID0gY29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCk7XG4gIGNvbnN0IHByb2Nlc3NvciA9IGNvbnRleHQuY3JlYXRlU2NyaXB0UHJvY2Vzc29yKGJ1ZmZlckZyYW1lU2l6ZSwgMSwgMSk7XG5cbiAgb3NjLmNvbm5lY3QocHJvY2Vzc29yKTtcbiAgb3NjLmNvbm5lY3QoY29udGV4dC5kZXN0aW5hdGlvbik7XG4gIHByb2Nlc3Nvci5jb25uZWN0KGNvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gIHByb2Nlc3Nvci5vbmF1ZGlvcHJvY2VzcyA9IGZ1bmN0aW9uKGUpIHtcbiAgICBsZXQgcHJvY2Vzc0RhdGEgPSBlLmlucHV0QnVmZmVyLmdldENoYW5uZWxEYXRhKDApO1xuICAgIHJlbWFpbmRlciA9IHJlbWFpbmRlci5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwocHJvY2Vzc0RhdGEsIDApKTtcbiAgICByZW1haW5kZXIgPSBnb2VydHplbChrLCBiaW5zUGVyQml0LCByZW1haW5kZXIsIG91dCk7XG4gIH07XG5cbiAgZGF0YS5zcGxpdCgnJykuZm9yRWFjaChmdW5jdGlvbih2LCBpKSB7XG4gICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSh2ID09ICcxJyA/IGhpZ2ggOiBsb3csIGkgKiBsZW5ndGggKyBjb250ZXh0LmN1cnJlbnRUaW1lKTtcbiAgfSk7XG5cbiAgb3NjLnN0YXJ0KGNvbnRleHQuY3VycmVudFRpbWUpO1xuICBvc2MuZnJlcXVlbmN5LnZhbHVlID0gMDtcblxuICBvc2Muc3RvcChkYXRhLmxlbmd0aCAqIGxlbmd0aCArIGNvbnRleHQuY3VycmVudFRpbWUpO1xuICBsYXN0VGltZSA9IGRhdGEubGVuZ3RoICogbGVuZ3RoO1xuXG4gIG9zYy5vbmVuZGVkID0gZnVuY3Rpb24oKSB7XG4gICAgb3NjLmRpc2Nvbm5lY3QocHJvY2Vzc29yKTtcbiAgICBvc2MuZGlzY29ubmVjdChjb250ZXh0LmRlc3RpbmF0aW9uKTtcbiAgICBwcm9jZXNzb3IuZGlzY29ubmVjdChjb250ZXh0LmRlc3RpbmF0aW9uKTtcbiAgICBkZWNvZGUob3V0LCBiYXVkKTtcbiAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHJ1bjogcnVuXG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihiaW5hcnkpIHtcbiAgdmFyIG91dCA9ICcnO1xuICB3aGlsZShiaW5hcnkubGVuZ3RoID49IDgpIHtcbiAgIHZhciBieXRlID0gYmluYXJ5LnNsaWNlKDAsIDgpO1xuICAgdmFyIGJpbmFyeSA9IGJpbmFyeS5zbGljZSg4KTtcbiAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGJ5dGUsIDIpKTtcbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHN0cikge1xuICB2YXIgcGFkID0gXCIwMDAwMDAwMFwiO1xuXG4gIHJldHVybiBzdHIuc3BsaXQoJycpLm1hcChmdW5jdGlvbihzdHIpIHtcbiAgICB2YXIgYmluYXJ5ID0gc3RyLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMik7XG5cbiAgICByZXR1cm4gcGFkLnNsaWNlKGJpbmFyeS5sZW5ndGgpK2JpbmFyeTtcbiAgfSkuam9pbignJyk7XG59XG4iXX0=
